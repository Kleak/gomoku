(function(e){function t(e,t,n){this.addr=e;this.port=t;this.createInfo=null;this.result={}||this.result;this.callback=n;this._create()}function n(e,t){var n=new Blob([new Uint8Array(e)]);var r=new FileReader;r.onload=function(e){t(e.target.result)};r.readAsText(n)}function r(e,t){var n=new Blob([e]);var r=new FileReader;r.onload=function(e){t(e.target.result)};r.readAsArrayBuffer(n)}t.prototype._create=function(){this.createInfo=null;chrome.socket.create("tcp",{},this._callbackCreate.bind(this))};t.prototype._callbackCreate=function(e){this.createInfo=e;this._connect();this.updateInfo()};t.prototype._connect=function(){chrome.socket.connect(this.createInfo.socketId,this.addr,this.port,this._callbackConnect.bind(this))};t.prototype._callbackConnect=function(e){if(e==0)this.result.connected=true;else this.result.connected=false;this.callback(e)};t.prototype._getInfo=function(){if(this.createInfo!=null)chrome.socket.getInfo(this.createInfo.socketId,this._callbackGetInfo.bind(this))};t.prototype._callbackGetInfo=function(e){this.result=e;if(this.result.connected==false){if(this.result.localAddress==undefined){if(this.createInfo!=undefined)chrome.socket.disconnect(this.createInfo.socketId);this.createInfo=null}}};t.prototype.updateInfo=function(){if(this.createInfo!=null){this._getInfo();chrome.alarms.create("socketUpdate",{when:Date.now()+5})}else this._create(this.callback)};t.prototype.write=function(e){r(e+"\n",function(e){chrome.socket.write(this.createInfo.socketId,e,function(e){}.bind(this))}.bind(this))};t.prototype.read=function(e){chrome.socket.read(this.createInfo.socketId,function(t){n(t.data,e)})};t.prototype.isConnected=function(){if(this.result!=null)return this.result.connected;else return false};t.prototype.disconnect=function(){chrome.alarms.clear("socketUpdate");chrome.socket.disconnect(this.createInfo.socketId)};e.Sock=t})(window)