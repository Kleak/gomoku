var host="10.12.181.17";
var port=8888;

window.onload=function(){function G(){e=0;t=0;n=1;r=0;i=0;o=null;j=[];F=[];I=[];q=0}function Y(){j=[];F=[];I=[]}function Z(e){var t=1;var n=1;var r=e.split(" ");var i=0;var s=0;while(n<=19){while(t<=19){if(r[s]!=0&&r[s]){j[i]=t*40;F[i]=n*40;I[i]=r[s];i++}s++;t++}t=1;n++}pt(U,j,F,I)}function et(e){var t=e.split(" ");if(t[2]==3)i=1;else if(t[2]==2)r=2;else r=1}function tt(){O.style.display="none";S.style.display="block"}function nt(){O.style.display="none"}function rt(e){var n=e.split(" ");var r=j.length;j[r]=(parseInt(n[1])+1)*40;F[r]=(parseInt(n[2])+1)*40;I[r]=n[3];pt(U,j,F,I);t=1}function it(){if(z!=-1&&W!=-1){mt(j,F,I,z,W);pt(U,j,F,I);z=-1;W=-1;t=0}}function st(e,t){O.innerHTML=e;O.style.display="block";chrome.alarms.create("toast",{when:Date.now()+t})}function ot(e,t){O.innerHTML=e;h.style.display="block";O.style.display="block";chrome.alarms.create("report",{when:Date.now()+5e3})}function ut(e,t){var n;n=e.substring(t,e.length);st(n,2500)}function at(n){var r=n.split(" ");e=1;if(s==1){t=1;B.style.display="block"}else{t=r[1];if(parseInt(r[1])==1)B.style.display="block"}}function ft(e){var t=e.split(":");var n=0;var r=(parseInt(t[0])+1)*40;var i=(parseInt(t[1])+1)*40;while(n<j.length){if(j[n]==r&&F[n]==i){j.splice(n,1);F.splice(n,1);I.splice(n,1);return 0}n++}}function lt(e){var t=e.split("\n");var r=0;var s=t.length;if(t.length<2)return null;while(r<s){cm=t[r];if(n==1){if(cm=="KICK"){socket.Disconnect();J.innerHTML="You was kick from server"}if(cm=="RETRY"){x.style.display="none";S.style.display="block";ut("Username allready exist",0)}if(cm.indexOf("JOIN")!=-1){if(cm.indexOf("ko")==-1){et(cm);socket.Read(lt)}else{v.style.border="2px solid #ff0000";m.style.border="2px solid #ff0000"}}if(cm.indexOf("DUMPMAP")!=-1)Z(cm.substring(8,cm.length-8));if(t=="WELCOME"){ot("A server error was occured, please reconnect. Sorry for this interruption",5e3);G()}if(cm.indexOf("START")!=-1)at(cm);if(cm.indexOf("PION")!=-1)rt(cm);if(cm.indexOf("CLK ok")!=-1)it();if(cm.indexOf("CLK ko ")!=-1)ut(cm,7);if(cm.indexOf("JOIN ko ")!=-1)ut(cm,1);if(cm.indexOf("WIN")!=-1){_.play();if(i!=1){st("You Win GG !",5e3);B.style.display="none"}else{var o=cm.split(" ");var u;if(parseInt(o)==1)u="BLANC";else u="NOIR";st(u+" Win GG !",5e3);B.style.display="none"}h.style.display="block"}if(cm.indexOf("LOOSE")!=-1){D.play();st("You loose !",5e3);h.style.display="block";B.style.display="none"}if(cm.indexOf("CLEAR")!=-1){var a=cm.split(" ");var f=a.length;var l=0;while(l<f){ft(a[l]);l++}pt(U,j,F,I)}}else{if(cm=="WELCOME"){n=1;C.style.display="none";S.style.display="block";chrome.alarms.create("read",{when:Date.now()+500})}}r++}}function ct(){if(socketIsConnected()){J.innerHTML="Vous êtes connecté";if(!X){X=true;V=false}}else{if(J.innerHTML!="Connexion en cours ..."){J.innerHTML="Re-connection en cours veuillez patienter ...";if(!V){V=true;X=false}}}chrome.alarms.create("cronSocket",{when:Date.now()+1e3})}function ht(e){e.clearRect(0,0,800,800)}function pt(e,t,n,r){if(R.getContext){ht(e);e.beginPath();for(var i=0;i<19;i++){e.strokeStyle="#000000";e.moveTo(40+40*i,40);e.lineTo(40+40*i,800-40);e.moveTo(40,40+40*i);e.lineTo(800-40,40+40*i);e.stroke()}e.closePath();var s=t.length;var o=document.getElementById("pi1");var u=document.getElementById("pi2");for(var i=0;i<s;i++){e.beginPath();if(r[i]==1)e.drawImage(o,t[i]-20,n[i]-20);else if(r[i]==2)e.drawImage(u,t[i]-20,n[i]-20);e.fill();e.closePath()}}}function dt(e){if(e%40>20)e=e+(40-e%40);else e=e-e%40;if(e/40>19)e=e-40;if(e/40<1)e=40;return e}function vt(e,t,n,r,i){var s=0;while(s<i){if(e[s]==n&&t[s]==r)return true;s++}return false}function mt(e,t,n,i,s){var o=e.length;var u=vt(e,t,i,s,o);if(u==false){e[o]=i;t[o]=s;n[o]=r;q++}}var e=0;var t=0;var n=0;var r=0;var i=0;var s=0;var o=null;var u=document.getElementById("pvp");var a=document.getElementById("pve");var f=document.getElementById("target_channel");var l=document.getElementById("target_channel_pve");var c=document.getElementById("random_channel");var h=document.getElementById("backscreen");var p=document.getElementById("pvp_mod");var d=document.getElementById("pve_mod");var v=document.getElementById("pvp_channel");var m=document.getElementById("pve_channel");var g=document.getElementById("close_pvp");var y=document.getElementById("close_pve");var b=document.getElementById("close_login");var w=document.getElementById("login");var E=document.getElementById("send_login");var S=document.getElementById("log_box");var x=document.getElementById("modBox");var T=document.getElementById("modPVP");var N=document.getElementById("modPVE");var C=document.getElementById("loading");var k=document.getElementById("notification");var L=document.getElementById("content_notification");var A=document.getElementById("close_notification");var O=document.getElementById("toast");var M=document.getElementById("info_box");var _=document.getElementById("win");var D=document.getElementById("loose");var P=document.getElementById("myswitch_button");var H=document.getElementById("myswitch1_button");var B=document.getElementById("rules");var j=[];var F=[];var I=[];var q=0;var R=document.getElementById("board");var U=R.getContext("2d");var z=-1;var W=-1;var X=false;var V=true;var $=document.getElementById("menubar");var J=document.getElementById("state");J.style.position="absolute";J.style.top="20px";J.style.left=window.innerWidth/2-100+"px";J.style.width="200px";J.style.textAlign="center";var K=document.getElementById("close");var Q=socket.Create(host,port,function(e){if(e==0){J.innerHTML="You are connected";X=true;V=false;socket.Write("WELCOME ImPanda");socket.Read(lt)}ct()});chrome.alarms.onAlarm.addListener(function(e){if(e.name=="report"){tt()}if(e.name=="toast"){nt()}if(e.name=="read"){if(Q.createInfo.socketId!=null){socket.Read(lt);chrome.alarms.create("read",{when:Date.now()+500})}}if(e.name=="cronSocket"){ct()}});K.onclick=function(e){socket.Write("LOGOUT "+w.value);closeApp()};window.onresize=function(){K.style.width=window.innerWidth/2-100+"px"};T.onclick=function(e){if(n==1){x.style.display="none";p.style.display="block"}};E.onclick=function(e){if(w.value.length){o=w.value;S.style.display="none";socket.Write("LOGIN "+w.value);socket.Read(lt);x.style.display="block"}else{w.style.border="2px solid #ff0000"}};g.onclick=function(e){p.style.display="none"};u.onclick=function(e){if(n==1)p.style.display="block"};f.onclick=function(e){if(v.value.length){Y();socket.Write("JOIN "+o+" "+v.value+" 0");if(v.style.border!="2px solid #ff0000"){p.style.display="none";h.style.display="none";s=0}}else v.style.border="2px solid #ff0000"};l.onclick=function(e){if(m.value.length){Y();socket.Write("JOIN "+o+" "+m.value+" 1");if(m.style.border!="2px solid #ff0000"){d.style.display="none";h.style.display="none";s=1}}else m.style.border="2px solid #ff0000"};c.onclick=function(e){if(n==1){socket.Write("RJOIN");socket.Read(lt);p.style.display="none";h.style.display="none"}};pt(U,j,F,I);R.onmousemove=function(n){var r=n.clientX;var s=n.clientY;var o=10;if(i==0&&e==1&&t==1){r=dt(r);s=dt(s);pt(U,j,F,I);U.beginPath();U.arc(r,s,o,0,2*Math.PI,false);U.fillStyle="red";U.fill();U.closePath()}};R.onclick=function(n){var r=dt(n.clientX);var s=dt(n.clientY);if(i==0&&e==1&&t==1){socket.Write("CLK "+o+" "+r/40+" "+s/40);z=r;W=s;socket.Read(lt)}};var gt=false;var yt=false;P.onclick=function(e){if(gt!=true){socket.Write("RULE "+w.value+" DOUBLE_THREE 1");gt=true}else{socket.Write("RULE "+w.value+" DOUBLE_THREE 0");gt=false}};H.onclick=function(e){if(yt!=true){socket.Write("RULE "+w.value+" FIVE_BROCK 1");yt=true}else{socket.Write("RULE "+w.value+" FIVE_BROCK 0");yt=false}}}